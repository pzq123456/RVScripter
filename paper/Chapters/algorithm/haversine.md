# 半正矢公式及将地球视为球体（haversine）
> - https://zh.wikipedia.org/wiki/%E5%8D%8A%E6%AD%A3%E7%9F%A2%E5%85%AC%E5%BC%8F
> - https://www.movable-type.co.uk/scripts/latlong.html
> - https://www.movable-type.co.uk/scripts/latlong-vincenty.html
> - 将地球视为球体的精度问题：https://gis.stackexchange.com/questions/25494/how-accurate-is-approximating-earth-as-sphere#25580
## 0. 大纲（论述思路）：论述将地球作为球体来处理的合理性
- 为什么使用 haversine 公式？
  - 为什么可以将地球视为球体？
  - WGS84 并没有大地基准
  - 球体模型的精度问题
  - Vincenty 公式
  - 为什么使用球体模型计算距离是足够的？

## 1. 我的 WebGIS 为什么可以将地球视为球体？
- 首先定义误差(假定正确的距离为椭圆上的距离D，计算得到的距离为球体上的距离d)：
  - 残差: D-d
  - 相对误差: (D-d)/D 
- 然后考虑影响因素：
  - 始末点位置：纬度差异越大，误差越大
  - 距离：距离越大，误差越大
  - 方向：方向越偏离赤道，误差越大
- 最后给出结论：
所有的这些公式都是基于球形地球（忽略椭球体效应）的计算，这对于大多数目的来说是足够精确的*……[事实上，地球是非常轻微的椭球体；使用球形模型通常会产生高达0.3%1的误差——有关详细信息，请参阅注释]。

精度：由于地球不完全是一个球体，使用球形几何会产生一些小误差；事实上，地球实际上大致是椭球体（或更精确地说，是扁球体），其半径在赤道附近约为6,378km（赤道）和6,357km（极地），曲率半径在赤道子午线约为6,336km到极地约为6,399km。6,371 km是地球平均半径的普遍接受值。这意味着假设球形几何可能会产生高达0.55%的误差，尽管通常在0.3%以下，具体取决于纬度和行进方向（whuber在stackexchange上对此进行了出色的详细探讨）。
在1km内的3m精度对我来说基本上已经足够了，但如果你需要更高的精度，你可以使用Vincenty公式来计算椭球体上的测地线距离，这可以得到精度在1mm以内的结果。（出于纯粹的倔强——我从未需要过这样的精度——我查找了这个公式，发现JavaScript实现比我预期的要简单）。

## 2. WGS84 并没有大地基准
> https://www.movable-type.co.uk/scripts/latlong-vincenty.html#datums
此外，人们熟悉的WGS-84（1984年世界大地测量系统）没有“物理实现”——它与大地测量地面站无关，只与卫星有关——并且被定义为精度不超过±1米左右，无论你的GPS设备有多好[实际上，“G系列”更准确一点，但没有官方的转换参数]。对于大多数目的来说，一米已经足够了，但距离Vincenty的毫米精度还有很长的路要走。因此基于 WGS84 的 GeoJSON 数据，使用球形地球模型计算距离是足够的。

