<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Canvas Zoom with Offscreen Rendering</title>
</head>
<body>
    <!-- 主线程Canvas -->
    <canvas id="mainCanvas" width="400" height="300"></canvas>

    <script>
        const mainCanvas = document.getElementById('mainCanvas');
        const mainContext = mainCanvas.getContext('2d');

        // 创建离屏Canvas
        const offscreenCanvas = new OffscreenCanvas(mainCanvas.width, mainCanvas.height);
        const offscreenContext = offscreenCanvas.getContext('2d');

        // 初始化缩放比例
        let scale = 1;
        // 处理鼠标滚轮事件
        mainCanvas.addEventListener('wheel', (event) => {
            // 阻止默认滚轮事件
            event.preventDefault();

            // 根据滚轮方向调整缩放比例
            scale += event.deltaY > 0 ? -0.1 : 0.1;

            // 限制最小和最大缩放比例
            scale = Math.max(0.1, Math.min(scale, 3));

            // 清空离屏Canvas
            offscreenContext.clearRect(0, 0, offscreenCanvas.width, offscreenCanvas.height);

            // 在离屏Canvas上进行绘制，根据缩放比例进行缩放
            offscreenContext.save();
            offscreenContext.scale(scale, scale);
            offscreenContext.fillStyle = 'blue';
            offscreenContext.fillRect(50, 50, 300, 200);
            offscreenContext.restore();

            // 将离屏Canvas的内容绘制到主线程Canvas上
            mainContext.clearRect(0, 0, mainCanvas.width, mainCanvas.height);
            mainContext.drawImage(offscreenCanvas, 0, 0);
        }, { passive: true });
    </script>
</body>
</html>
